<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>מרכז שיעורי הר הבית</title>
<link rel="stylesheet" href="style.css">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>

<style>
.background-image {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background: url('1.png') center center / cover no-repeat;
  opacity: 0.3; z-index: -1;
}
.modal-content--summary { max-height: 80vh; overflow:auto; }
.summary-btn { background:#ff9800; color:#fff; border:none; padding:6px 10px; border-radius:6px; cursor:pointer; font-size:0.9em; margin-top:6px; }
.summary-btn:hover { background:#e68900; }
.lesson-actions { display:flex; gap:8px; flex-wrap:wrap; margin-top:6px; }
.modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:1000; }
.modal.show { display:flex; }
.modal-content { position:relative; background:#fff; padding:20px; max-width:90%; max-height:90%; overflow:auto; border-radius:8px; }
.modal-close { font-size:1.2rem; color:#555; background:transparent; border:none; cursor:pointer; position:absolute; top:8px; right:8px; line-height:1; }
.modal-close:hover { color:#000; }
</style>
</head>
<body>

<div class="background-image"></div>

<!-- ב־<head> של הדף -->
<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">

<header>
  <img src="logo.png" alt="לוגו האתר" class="site-logo">
  <h1>מרכז שיעורי הר הבית</h1>
  <a href="admin.html" class="admin-link">כניסת מנהל</a>
</header>

<style>
/* סגנון ל־header */
header {
  position: sticky; /*הכותרת לא תישאר במקומה הרגיל */
  background: #CD853F; /* צבע חום */
  color: white;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 5px 20px; /* padding ימין ושמאל אחיד */
  box-sizing: border-box;
}

/* סגנון ללוגו */
.site-logo {
  height: 90px;
  width: auto;
}

/* סגנון לכותרת */
h1 {
  font-family: 'Great Vibes', cursive; /* פונט קליגרפי */
  font-size: 60px;
  margin: 0;
  padding-left: 511px; /* אפשר לשנות למיקום הרצוי */
  white-space: nowrap; /* מונע שבירה לשורה חדשה */
}

/* סגנון לקישור מנהל */
.admin-link {
  color: white;
  text-decoration: none;
}

/* רספונסיביות בסיסית למסכים קטנים */
@media (max-width: 1200px) {
  h1 {
    font-size: 60px;
    padding-left: 300px;
  }
}

@media (max-width: 800px) {
  h1 {
    font-size: 40px;
    padding-left: 100px;
  }
}
</style>

<div class="search-background">
  <div class="search-container">
    <input type="text" id="search" placeholder="חפש לפי שם שיעור או שם הרב...">
  </div>
</div>

<style>
/* רקע חום מלא רוחב המסך שמאחורי התיבה */
.search-background {
  background-color: #CD853F;
  padding-top: 6px;
  padding-bottom: 6px;
  padding-left: 10px;  /* רווח מימין */
  padding-right: 550px; /* רווח משמאל */
  
  width: 100%;
  top: 20px;
  z-index: 100;
}

/* המיכל של התיבה */
.search-container {
  width: 100%;
  max-width: 600px; /* רוחב מקסימלי */
}

/* תיבת החיפוש */
.search-container input {
  width: 100%;
  height: 40px;
  font-size: 18px;
  padding: 0 10px;
  box-sizing: border-box;
}
</style>









<div
<div style="display:flex; gap:10px; margin-bottom:20px; padding:0 10px; padding-top: 5px;">
  <select id="category-select">
    <option value="">כל הקטגוריות</option>
    <option value="הלכה">הלכה</option>
    <option value="היסטוריה">היסטוריה</option>
    <option value="פרשת השבוע">פרשת השבוע</option>
  </select>
</div>

<main id="lessons-container"></main>

<!-- מודאל וידאו -->
<div id="modal" class="modal" aria-hidden="true">
  <div class="modal-content">
    <button id="close-modal" class="modal-close" aria-label="סגור">×</button>
    <iframe id="modal-video" width="100%" height="450" frameborder="0" allowfullscreen></iframe>
  </div>
</div>

<!-- מודאל סיכום -->
<div id="summary-modal" class="modal" aria-hidden="true">
  <div class="modal-content modal-content--summary">
    <button id="close-summary-modal" class="modal-close" aria-label="סגור">×</button>
    <div id="summary-content"></div>
  </div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyA9CHKDvVmhPSv6U2UpVj-QGyriF5QDjk0",
  authDomain: "har-habait-lessons.firebaseapp.com",
  projectId: "har-habait-lessons",
  storageBucket: "har-habait-lessons.appspot.com",
  messagingSenderId: "518010109655",
  appId: "1:518010109655:web:cd628123d6769aa87a7a92",
  measurementId: "G-RSNSTT3QL8"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const container = document.getElementById('lessons-container');
const modal = document.getElementById('modal');
const modalVideo = document.getElementById('modal-video');
const closeModal = document.getElementById('close-modal');
const summaryModal = document.getElementById('summary-modal');
const summaryContent = document.getElementById('summary-content');
const closeSummaryModal = document.getElementById('close-summary-modal');

function getYouTubeId(url) {
  const regExp = /^.*(?:youtu\.be\/|v\/|u\/\w\/|embed\/|watch\?v=|watch\?.+&v=)([^#\&\?]{11}).*/;
  const match = url?.match(regExp);
  return (match && match[1]) ? match[1] : null;
}
function normalizeText(str) { return str ? str.trim().toLowerCase() : ""; }

let allLessons = [];

db.collection("lessons").onSnapshot(snapshot => {
  allLessons = [];
  snapshot.forEach(doc => {
    const data = doc.data();
    data.id = doc.id;
    allLessons.push(data);
  });
  filterAndSortLessons();
});

function renderLessons(lessons) {
  container.innerHTML = '';
  lessons.forEach(data => {
    const videoID = getYouTubeId(data.youtube);
    let dateStr = "לא זמין";
    if (data.timestamp?.toDate) dateStr = data.timestamp.toDate().toLocaleDateString('he-IL', { year:'numeric', month:'long', day:'numeric' });
    else if (data.timestamp?.seconds) dateStr = new Date(data.timestamp.seconds*1000).toLocaleDateString('he-IL', { year:'numeric', month:'long', day:'numeric' });

    const lessonDiv = document.createElement('div');
    lessonDiv.className = 'lesson-card';
    lessonDiv.dataset.id = data.id;

    lessonDiv.innerHTML = `
      <img src="${videoID ? `https://img.youtube.com/vi/${videoID}/hqdefault.jpg` : 'https://via.placeholder.com/320x180?text=No+Image'}" alt="${data.title || ""}">
      <div class="lesson-meta">
        <h3>${data.title || ""}</h3>
        <p><strong>הרב:</strong> ${data.rabbi || ""}</p>
        <p><strong>קטגוריה:</strong> ${data.category || "לא סווג"}</p>
        <p><strong>תאריך:</strong> ${dateStr}</p>
        <div class="lesson-actions">
          ${videoID ? `<button class="watch-btn" data-id="${data.id}">צפייה</button>` : ""}
          ${data.summary ? `<button class="summary-btn" data-id="${data.id}">הצגת סיכום</button>` : ""}
        </div>
      </div>
    `;
    container.appendChild(lessonDiv);
  });
}

container.addEventListener('click', (e) => {
  const id = e.target.dataset?.id;
  if (e.target.classList.contains('watch-btn')) {
    const lesson = allLessons.find(l => l.id === id);
    const videoID = getYouTubeId(lesson?.youtube);
    if (videoID) { modalVideo.src = `https://www.youtube.com/embed/${videoID}`; modal.classList.add('show'); modal.setAttribute('aria-hidden', 'false'); }
  }
  if (e.target.classList.contains('summary-btn')) {
    const lesson = allLessons.find(l => l.id === id);
    if (lesson?.summary) { summaryContent.innerHTML = lesson.summary; summaryModal.classList.add('show'); summaryModal.setAttribute('aria-hidden','false'); }
  }
});

container.addEventListener('click', (e) => {
  if (e.target.closest('button')) return;
  const card = e.target.closest('.lesson-card');
  if (!card) return;
  const lesson = allLessons.find(l => l.id === card.dataset.id);
  const videoID = getYouTubeId(lesson?.youtube);
  if (videoID) { modalVideo.src = `https://www.youtube.com/embed/${videoID}`; modal.classList.add('show'); modal.setAttribute('aria-hidden', 'false'); }
});

function filterAndSortLessons() {
  const searchTerm = normalizeText(searchInput.value);
  const category = categorySelect.value;

  let filtered = allLessons.filter(l => {
    const matchesSearch = normalizeText(l.title).includes(searchTerm) || normalizeText(l.rabbi).includes(searchTerm);
    const matchesCategory = category ? l.category === category : true;
    return matchesSearch && matchesCategory;
  });

  filtered.sort((a,b)=> (b.timestamp?.seconds || 0) - (a.timestamp?.seconds || 0));

  renderLessons(filtered);
}

const searchInput = document.getElementById('search');
const categorySelect = document.getElementById('category-select');
searchInput.addEventListener('input', filterAndSortLessons);
categorySelect.addEventListener('change', filterAndSortLessons);

closeModal.addEventListener('click', () => { modalVideo.src=''; modal.classList.remove('show'); modal.setAttribute('aria-hidden','true'); });
closeSummaryModal.addEventListener('click', () => { summaryModal.classList.remove('show'); summaryModal.setAttribute('aria-hidden','true'); });
modal.addEventListener('click', (e)=>{ if(e.target===modal){ modalVideo.src=''; modal.classList.remove('show'); modal.setAttribute('aria-hidden','true'); }});
summaryModal.addEventListener('click', (e)=>{ if(e.target===summaryModal){ summaryModal.classList.remove('show'); summaryModal.setAttribute('aria-hidden','true'); }});
</script>

<footer>
  <div class="wave"></div>
  <p>כל הזכויות שמורות © 2025 מרכז שיעורי הר הבית | לפרטים וליצירת קשר: 055-9962656 | glasser.avraham@gmail.com</p>
</footer>

<style>
  footer {
    position: relative;
    background: #CD853F
; /* צבע רקע של הפוטר */
    color: white;
    text-align: center;
    padding: 3px 3px 3px 3px;
  }
: cover;
  }
</style>

</body>
</html>
